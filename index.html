<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="icon.png" />
    <meta name="apple-mobile-web-app-title" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>startpage</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Short+Stack&display=swap");
      body {
        font-family: "Short Stack", cursive;
      }
    </style>
    <link rel="stylesheet" href="doodle.css" />
    <link rel="stylesheet" type="text/css" href="styles.css" media="screen" />
  </head>

  <body class="doodle">
    <div class="center-container">
      <div class="image-container">
        <img class="image" id="center-image" src="assets/placeholder.png" />
      </div>

      <div class="links-container">
        <div class="links-group">
          <h2>Personal</h2>
          <ul class="links-list">
            <li><a href="https://mail.google.com/">Gmail</a></li>

            <li><a href="https://calendar.google.com/">Calendar</a></li>
          </ul>
        </div>

        <div class="links-group">
          <h2>Productivity</h2>
          <ul class="links-list">
            <li><a href="https://github.com/">GitHub</a></li>

            <li><a href="https://stackoverflow.com/">StackOverflow</a></li>
          </ul>
        </div>

        <div class="links-group">
          <h2>Entertainment</h2>
          <ul class="links-list">
            <li><a href="https://reddit.com/">Reddit</a></li>

            <li><a href="https://news.ycombinator.com/">Hacker News</a></li>
          </ul>
        </div>
      </div>
      <fieldset onclick="initTodo(event)">
        <legend>Todo</legend>
        <div id="todo-list"></div>
      </fieldset>
    </div>

    <template id="todo-item-template">
      <div class="todo-item">
        <label>
          <input type="checkbox" onchange="check()" />
          <span>
            <input
              type="text"
              class="todo-input"
              onkeydown="handleKeyPress(event)"
            />
          </span>
        </label>
      </div>
    </template>

    <script>
      const initTodo = (event) => {
        const todoList = getTodoList();
        if (todoList.length === 0) {
          createTodoItem({ checked: false, text: "" });
          renderTodoList();
          focusOnLastItem();
        }
      };

      const focusOnLastItem = () => {
        const todoList = getTodoList();
        const item =
          document.getElementsByClassName("todo-input")[todoList.length - 1];
        item.focus();

        // Move the cursor to the end
        const length = item.value.length;
        item.setSelectionRange(length, length);
      };

      const check = (event) => {};

      const handleKeyPress = (event) => {
        if (event.key === "Enter") {
          const index = event.target.getAttribute("data-index");
          const value = event.target.value;

          const checkbox = document.querySelector(
            `input[data-index="${index}"]`
          );

          updateTodoItem(index, { checked: checkbox.checked, text: value });
          const todoList = getTodoList();
          if (todoList[todoList.length - 1].text !== "") {
            createTodoItem({ checked: false, text: "" });
          }
          renderTodoList();
          focusOnLastItem();
        }

        if (event.key === "Backspace" && event.target.value === "") {
          event.preventDefault();
          const index = event.target.getAttribute("data-index");
          deleteTodoItem(index);
          renderTodoList();
          focusOnLastItem();
        }
      };

      const createTodoElement = (item, index) => {
        todoItemTemp = document.getElementById("todo-item-template");

        /* input */
        const input = todoItemTemp.content.querySelector(".todo-input");

        input.dataset.index = index;
        input.value = item.text;

        /* checkbox */
        const checkbox = todoItemTemp.content.querySelector(
          "input[type=checkbox]"
        );

        checkbox.addEventListener("change", (event) => {
          const index = event.target.getAttribute("data-index");
          const value = event.target.value;
          const checked = event.target.checked;

          updateTodoItem(index, { checked: checked, text: value });
        });
        checkbox.dataset.index = index;
        checkbox.checked = item.checked;

        return todoItemTemp.content.querySelector("div").cloneNode(true);
      };

      const updateTodoItem = (index, value) => {
        const todoList = getTodoList();
        todoList[index] = value;
        localStorage.setItem("todoList", JSON.stringify(todoList));
      };

      const createTodoItem = (value) => {
        const todoList = getTodoList();
        todoList.push(value);
        localStorage.setItem("todoList", JSON.stringify(todoList));
      };

      const deleteTodoItem = (index) => {
        const todoList = getTodoList();
        todoList.splice(index, 1);
        localStorage.setItem("todoList", JSON.stringify(todoList));
      };

      const getTodoList = () => {
        const todoList = JSON.parse(localStorage.getItem("todoList")) || [];
        return todoList;
      };

      const renderTodoList = () => {
        const todoList = JSON.parse(localStorage.getItem("todoList")) || [];
        document.getElementById("todo-list").innerHTML = "";
        todoList.forEach((item, index) => {
          todoItem = createTodoElement(item, index);
          document.getElementById("todo-list").appendChild(todoItem);
        });
      };

      renderTodoList();
    </script>
  </body>
</html>
